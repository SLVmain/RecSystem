
# Курс "Глубокое обучение на практике" (Project_03)

Задание: на любых открытых данных выполнить ML проект и объяснить применимость на практике

**ДВУХУРОВНЕВАЯ РЕКОМЕНДАТЕЛЬНАЯ СИСТЕМА ДЛЯ РИТЕЙЛА НА ОСНОВЕ LIGHTGBM**

***Целевая метрика - precision@5***

***Задача проекта:*** рекомендовать пользователе наиболее релевантные для него товары

**Данные:** иходные данные содержат 3 файла: hh_demographic.csv, product.csv, retail_train.csv

1. **hh_demographic.csv** - содержит информация о покупателе: такую как возраст, семейное положение, информация о доходе, наличие недвижимости, наличие детей, 
размер дома, количсетво детей
2. **product.csv** - содержит информацию о продуктах, такую как: идентификационный номер, производитель товара, категория товара, вес товара
3. **retail_train.csv** - таблица взаимодействия покупателя с товарами. Файл содержит информацию о id покупателя, id корзины покупателя, id товара, количество товара,
проданный объем, id магазина, информация о скидках, время покупкиб использованный скидочный купон

Для более ясного понимания кода вспомогательные модули были вынесены в отдельный модуль [src](https://github.com/SLVmain/RecSystem/tree/main/src). Решение задачи представленно в [ноутбуке](https://github.com/SLVmain/RecSystem/blob/main/rec_sys_lgbm.ipynb).
Модуль [src](https://github.com/SLVmain/RecSystem/tree/main/src) содержит следующие файлы: metrics.py, recommenders.py, utils.py

**metrics.py** - содержит скрипты для рассчета следующих метрик: *precision*, *precision@K*, *recall*, *recall@K*

**recommenders.py** - содержит класс *MainRecommender*, позволяющий выполнять рекомендации разными способами: топ-товаров по для каждого покупателя, топ-товаров 
для всех покупателей, похожие топ-товаров, купленным конкретным покупателем и т.д.

**utils.py** - фильтруем набор данных таким образом, что убирает самые популярные товары среди покупателей(их итак купят) и самые НЕ популярные товары 
(их итак не купят). Таким образом мы сокращаем количество примеров для обучения, при этом получаем возможность рекомендовать покупателю, которые он возможно еще не видел.

## Решение задачи (шаги):
1. Загрузка библиотеки implicit
2. Импорт библиотек
3. Загрузка исходных данных
4. Предобработка исходных данных
5. Формирование тренировочного и валидационного датасетов для первого и второго уровня рекомендательной системы, таким образом, чтобы учитывался фактор времени: 6 недель идут в *train*, следующие за ними 3 недели в *val*
6. Отбираем 5000 товаров из 83+ тысяч в исходном датасете так, чтобы исключить наиболее популярные (их итак купят) и самые НЕ популярные (их итак не купят).
7. ***На первом уровне*** учим модель рекомендовать 50 товаров. Алгоритм оценивался по метрике *precision@5*:

| Metric\Model|als_rec|
|--|--|
|precision@5|0.0037|

8. ***Второй уровень модели*** обучается на 50 выбранных на предыдущем этапе товарах, при этом если алгоритмы рекомендуют меньшее количество (< 50) товаров, то
недостающее количество добирается популярными товарами
   * 8.1. подтовка таргета: купил/не купил товар
   * 8.2. генерация дополнительных фичей:
      - средний чек покупателя;
      - количество покупок в каждой категории;
      - количество покупок в одной категории;
      - цена товара;
      - среднее количество покупок, совершенное всеми покупателями за неделю
   * 8.3. формирование выборок train и  val для второго уровня модели
   * 8.4. обучение модели lightGBM
   * 8.5. выдача рекомендаций и их оценка
9. Инференс - модель выдает 50 товаров

| Metric\Model|lightGBM|
|--|--|
|precision@5|0.9529|


## Дизайн А/Б тестирования
Следующий шаг при внедрении рекомендательной системы является A/B-тестирование. Эскперимент, позволяющий сравнить эффект от вводимых изменений. 
Поскольку выполнить его в рамках курса не возможно, то нами предложен дизайн проведения по шагам.
   * ***1. Цель:*** Увеличение объема продаж за счет внедрения разработанной рекомендательной системы, которая дает более персонализированные рекомендации.
   * ***2. Метрика:*** CONVERSION RATE  
  
        ![Иллюстрация к проекту](https://github.com/SLVmain/RecSystem/blob/main/conversion_rate_formula.png)
        
   * ***3. Гипотеза:*** *H0* - эффекта от персонализации рекомендаций нет. *Н1* - эффект от персонализации рекомендаций есть.
   
   * ***4. Подготовка эксперимента:***
     - Создание контрольной и экспериментальной групп
     - Имеющиеся (А) и разаработанные (В) рекомендации покупатели видят в случайном порядке
     - Уровень статистической значимости alpha = 0.05
     - Минимальный размер выборки для baseline conversion rate = 3% и minimum detectable effect = 20%, заявленном уровне значимости alpha = 0.05
     размер необходимой выборки 13000 на вариант. У нас их два.
     - Время проведения А/Б тестирования зависит от количества покупателей и тестируемых вариантов: если среднее количество покупателей в день равно 2000, 
     то время необходимое для проведение теста составляет 30 дней
   * ***5. Эксперимент:*** часть,которая выполнить не можем
   * ***6. Анализ результатов эксперимента:*** Рассчитывается метрика. Проверяется уровень статистической значимости p-value.
     - если p-value < alpha, То Н0 отвергается и эффект от персонализации рекомендаций есть
     - если p-value >= alpha, То Н0 не может быть отвергнута и эффекта от персонализации рекомендаций нет


## Команда 9.



